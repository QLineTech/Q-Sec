 LLM ve gerÃ§ek bir saldÄ±rÄ± aracÄ±nÄ± (Nmap) birleÅŸtiren kÃ¼Ã§Ã¼k bir framework hazÄ±rlayalÄ±m. Bu sayede hem analiz hem de pratik test yapabileceÄŸiz.



```python
import subprocess
from langchain.chains import LLMChain
from langchain_groq import ChatGroq
from langchain.prompts import PromptTemplate
import json
from datetime import datetime
import re

class SmartPortScanner:
    """
    Nmap ve LLM'i birleÅŸtiren akÄ±llÄ± port tarayÄ±cÄ±.
    Nmap ile gerÃ§ek tarama yapar, sonuÃ§larÄ± LLM ile analiz eder.
    """
    
    def __init__(self, api_key):
        # LLM'i baÅŸlat
        self.llm = ChatGroq(api_key=api_key, temperature=0.7)
        
        # Analiz ÅŸablonunu hazÄ±rla
        self.prompt = PromptTemplate(
            input_variables=["scan_results", "target"],
            template="""
            Bu Nmap tarama sonuÃ§larÄ±nÄ± analiz et:
            Hedef: {target}
            Tarama SonuÃ§larÄ±: {scan_results}

            LÃ¼tfen ÅŸunlarÄ± belirt:
            1. AÃ§Ä±k portlarÄ±n risk analizi
            2. Tespit edilen servislerin gÃ¼venlik deÄŸerlendirmesi
            3. Ã–nerilen gÃ¼venlik Ã¶nlemleri
            4. OlasÄ± saldÄ±rÄ± vektÃ¶rleri
            """
        )
        
        # LLM zincirini oluÅŸtur
        self.chain = LLMChain(
            llm=self.llm,
            prompt=self.prompt,
            verbose=True
        )

    def run_nmap_scan(self, target, scan_type="basic"):
        """
        Nmap taramasÄ± gerÃ§ekleÅŸtirir.
        
        scan_type parametreleri:
        - basic: Temel port taramasÄ±
        - stealth: Gizli SYN taramasÄ± (root gerektirir)
        - service: Servis versiyonu taramasÄ±
        """
        try:
            scan_commands = {
                "basic": ["nmap", "-F", target],  # HÄ±zlÄ± tarama
                "stealth": ["nmap", "-sS", "-Pn", target],  # Gizli tarama
                "service": ["nmap", "-sV", target]  # Servis taramasÄ±
            }
            
            # TaramayÄ± baÅŸlat
            print(f"\nğŸ” Nmap taramasÄ± baÅŸlatÄ±lÄ±yor: {target}")
            result = subprocess.run(
                scan_commands.get(scan_type, scan_commands["basic"]),
                capture_output=True,
                text=True
            )
            
            return result.stdout
            
        except subprocess.CalledProcessError as e:
            return f"Nmap hatasÄ±: {str(e)}"
        except Exception as e:
            return f"Beklenmeyen hata: {str(e)}"

    def analyze_scan(self, target, scan_type="basic"):
        """
        Hedefi tarar ve sonuÃ§larÄ± LLM ile analiz eder.
        """
        try:
            # Nmap taramasÄ±nÄ± yap
            scan_results = self.run_nmap_scan(target, scan_type)
            
            # SonuÃ§larÄ± LLM ile analiz et
            analysis = self.chain.run(
                scan_results=scan_results,
                target=target
            )
            
            # SonuÃ§larÄ± yapÄ±landÄ±r
            return {
                "target": target,
                "scan_type": scan_type,
                "timestamp": datetime.now().isoformat(),
                "raw_scan": scan_results,
                "analysis": self._parse_analysis(analysis),
                "open_ports": self._extract_open_ports(scan_results)
            }
            
        except Exception as e:
            return {
                "error": f"Analiz hatasÄ±: {str(e)}",
                "timestamp": datetime.now().isoformat()
            }

    def _extract_open_ports(self, nmap_output):
        """
        Nmap Ã§Ä±ktÄ±sÄ±ndan aÃ§Ä±k portlarÄ± Ã§Ä±karÄ±r.
        """
        open_ports = []
        for line in nmap_output.split('\n'):
            if 'open' in line and '/tcp' in line:
                # Port ve servis bilgisini ayÄ±kla
                match = re.search(r'(\d+)/tcp\s+open\s+(\w+)?', line)
                if match:
                    port, service = match.groups()
                    open_ports.append({
                        "port": int(port),
                        "service": service or "unknown"
                    })
        return open_ports

    def _parse_analysis(self, raw_analysis):
        """
        LLM analizini yapÄ±landÄ±rÄ±lmÄ±ÅŸ formata dÃ¶nÃ¼ÅŸtÃ¼rÃ¼r.
        """
        sections = {
            "risk_analysis": [],
            "service_assessment": [],
            "security_recommendations": [],
            "attack_vectors": []
        }
        
        current_section = None
        for line in raw_analysis.split('\n'):
            line = line.strip()
            if '1. AÃ§Ä±k portlarÄ±n risk analizi' in line:
                current_section = "risk_analysis"
            elif '2. Tespit edilen servislerin gÃ¼venlik deÄŸerlendirmesi' in line:
                current_section = "service_assessment"
            elif '3. Ã–nerilen gÃ¼venlik Ã¶nlemleri' in line:
                current_section = "security_recommendations"
            elif '4. OlasÄ± saldÄ±rÄ± vektÃ¶rleri' in line:
                current_section = "attack_vectors"
            elif line and current_section:
                sections[current_section].append(line)
        
        return sections

# KullanÄ±m Ã¶rneÄŸi
def main():
    try:
        # TarayÄ±cÄ±yÄ± baÅŸlat
        scanner = SmartPortScanner("your-api-key")
        
        # Test hedefi (Ã¶rnek olarak localhost)
        target = "127.0.0.1"
        
        # Tarama ve analizi gerÃ§ekleÅŸtir
        print("\nğŸš€ AkÄ±llÄ± Port TarayÄ±cÄ± BaÅŸlatÄ±ldÄ±")
        result = scanner.analyze_scan(target, "basic")
        
        # SonuÃ§larÄ± gÃ¶ster
        print("\nğŸ“Š Tarama SonuÃ§larÄ±")
        print("=" * 50)
        print(f"Hedef: {result['target']}")
        print(f"Tarama TÃ¼rÃ¼: {result['scan_type']}")
        
        print("\nğŸ”“ AÃ§Ä±k Portlar:")
        for port in result['open_ports']:
            print(f"- Port {port['port']}: {port['service']}")
        
        print("\nğŸ” LLM Analizi:")
        analysis = result['analysis']
        
        print("\nRisk Analizi:")
        for risk in analysis['risk_analysis']:
            print(f"- {risk}")
        
        print("\nServis DeÄŸerlendirmesi:")
        for service in analysis['service_assessment']:
            print(f"- {service}")
        
        print("\nGÃ¼venlik Ã–nerileri:")
        for recommendation in analysis['security_recommendations']:
            print(f"- {recommendation}")
        
        print("\nOlasÄ± SaldÄ±rÄ± VektÃ¶rleri:")
        for vector in analysis['attack_vectors']:
            print(f"- {vector}")
        
    except Exception as e:
        print(f"Hata oluÅŸtu: {str(e)}")

if __name__ == "__main__":
    main()
```



Bu kompakt framework'Ã¼ Ã¶zel yapan noktalarÄ± aÃ§Ä±klayayÄ±m:

1. **GerÃ§ek AraÃ§ Entegrasyonu:**
   - Nmap ile gerÃ§ek port taramasÄ± yapÄ±yoruz
   - FarklÄ± tarama tÃ¼rlerini destekliyoruz (temel, gizli, servis)
   - SonuÃ§larÄ± gerÃ§ek zamanlÄ± iÅŸleyebiliyoruz

2. **AkÄ±llÄ± Analiz:**
   - LLM, tarama sonuÃ§larÄ±nÄ± derinlemesine analiz ediyor
   - Risk seviyelerini deÄŸerlendiriyor
   - GÃ¼venlik Ã¶nerileri sunuyor
   - OlasÄ± saldÄ±rÄ± vektÃ¶rlerini belirliyor

3. **GÃ¼venlik Ã–zellikleri:**
   - Temel tarama varsayÄ±lan olarak seÃ§ili
   - Hata yÃ¶netimi entegre edilmiÅŸ
   - SonuÃ§lar yapÄ±landÄ±rÄ±lmÄ±ÅŸ formatta

Framework'Ã¼ kullanmak Ã§ok basit:

```python
# TarayÄ±cÄ±yÄ± baÅŸlat
scanner = SmartPortScanner("your-api-key")

# Hedefi tara ve analiz et
results = scanner.analyze_scan("example.com")

# SonuÃ§larÄ± gÃ¶rÃ¼ntÃ¼le
print(f"AÃ§Ä±k Portlar: {results['open_ports']}")
print(f"GÃ¼venlik Analizi: {results['analysis']}")
```

